Lo primero es tener 2 máquinas ubuntuserver.
Los adaptadores son:
Para la máquina de enmedio, NAT - Solo anfitrion - Red interna - Red interna
Para cada una de las dos máquinas extremo, un solo red interna.

Vamos a la máquina de enmedio, entramos y hacemos:

```bash
sudo nano /etc/netplan/50-cloud-init.yaml
```

Cambiamos:

![Cambios en 50-cloud-init.yaml](./1.png)

Hacemos sudo netplan apply para comprobar que funciona.

Vamos a añadir las IPs de las 2 máquinas de los extremos.

Volviendo a hacer

```bash
sudo nano /etc/netplan/50-cloud-init.yaml
```

Cambiamos:

![Cambios en 50-cloud-init.yaml](./2.png)

Con ip vemos que tenemos las IPs configuradas bien:

```bash
cesar@crb-server:~$ ip a
1: lo: <LOOPBACK,UP,LOWER_UP> mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1000
    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00
    inet 127.0.0.1/8 scope host lo
       valid_lft forever preferred_lft forever
    inet6 ::1/128 scope host noprefixroute
       valid_lft forever preferred_lft forever
2: enp0s3: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc fq_codel state UP group default qlen 1000
    link/ether 08:00:27:6f:15:5c brd ff:ff:ff:ff:ff:ff
    inet 10.0.2.15/24 metric 100 brd 10.0.2.255 scope global dynamic enp0s3
       valid_lft 86396sec preferred_lft 86396sec
    inet6 fd00::a00:27ff:fe6f:155c/64 scope global dynamic mngtmpaddr noprefixroute
       valid_lft 86396sec preferred_lft 14396sec
    inet6 fe80::a00:27ff:fe6f:155c/64 scope link
       valid_lft forever preferred_lft forever
3: enp0s8: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc fq_codel state UP group default qlen 1000
    link/ether 08:00:27:dd:be:6b brd ff:ff:ff:ff:ff:ff
    inet 192.168.56.10/24 brd 192.168.56.255 scope global enp0s8
       valid_lft forever preferred_lft forever
    inet6 fe80::a00:27ff:fedd:be6b/64 scope link
       valid_lft forever preferred_lft forever
4: enp0s9: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc fq_codel state UP group default qlen 1000
    link/ether 08:00:27:d8:e3:03 brd ff:ff:ff:ff:ff:ff
    inet 10.20.0.10/16 brd 10.20.255.255 scope global enp0s9
       valid_lft forever preferred_lft forever
    inet6 fe80::a00:27ff:fed8:e303/64 scope link
       valid_lft forever preferred_lft forever
5: enp0s10: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc fq_codel state UP group default qlen 1000
    link/ether 08:00:27:d2:b7:f5 brd ff:ff:ff:ff:ff:ff
    inet 10.30.0.10/16 brd 10.30.255.255 scope global enp0s10
       valid_lft forever preferred_lft forever
    inet6 fe80::a00:27ff:fed2:b7f5/64 scope link
       valid_lft forever preferred_lft forever
```

Ahora nos vamos a una de las máquinas de los extremos:

Hacemos sudo adduser sysadmin y lo añadimos.

Vamos a su fichero:

```bash
sudo nano /etc/netplan/50-cloud-init.yaml
```

Y añadimos:

![Cambios en 50-cloud-init.yaml](./3.png)

Hacemos sudo netplan apply y comprobamos con un ping que está conectada.

Ahora vamos a la máquina de Server-C.

Creamos el sysadmin.

Ahora entramos a su fichero:

```bash
sudo nano /etc/netplan/50-cloud-init.yaml
```

Para hacer que su adaptador red interna tenga la IP 10.30.0.20

![Cambios en 50-cloud-init.yaml](./4.png)

Hacemos sudo netplan apply y comprobamos con un ping que está conectada.

-----Ahora mismo sólo puedo hacer ping a Server-C y Server-B desde Server-A y no desde mi Windows.

Para poder hacer ping a Server-C tengo primero que conectarme desde mi windows mediante ssh a su sysadmin y su IP, una vez hecho eso ya estaría la red establecida.-----

Ahora hay que enviar las claves públicas entre todo el mundo para que se autentiquen entre ellos.

Empiezo por mi Windows y mi Server-A.

Ya tengo par de claves generadas en Windows:

```bash
PS C:\Users\cesar\.ssh> ls


    Directorio: C:\Users\cesar\.ssh


Mode                 LastWriteTime         Length Name
----                 -------------         ------ ----
-a----        16/10/2025     13:25            411 id_ed25519
-a----        16/10/2025     13:25             97 id_ed25519.pub
-a----        22/10/2025     10:56           1779 known_hosts
-a----        25/09/2025     13:20            937 known_hosts.old


PS C:\Users\cesar\.ssh> cat id_ed25519.pub
ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAICjoJGfflVMnPXkenHAhr0FSTrEegmhXPCIQAQnH20Nn cesar@LenovoI7
PS C:\Users\cesar\.ssh>
```

Ahora enviamos el archivo de clave pública al servidor mediante el comando scp:

```bash
PS C:\Users\cesar\.ssh> scp .\id_ed25519.pub cesar@192.168.56.10:~
cesar@192.168.56.10's password:
id_ed25519.pub                                                                        100%   97    18.9KB/s   00:00
PS C:\Users\cesar\.ssh>
```

Ahora vemos en Server-A el fichero con la clave (en el usuario cesar)

```bash
cesar@crb-server:~$ ls
id_ed25519.pub  pr0201
cesar@crb-server:~$
```

Ahí se encuentra la clave pública.

Ahora introducimos el contenido del fichero de la clave pública en el authorized keys: (creamos el fichero .ssh en el directorio del usuario si no existía)

```bash
cesar@crb-server:~$ mkdir .ssh
cesar@crb-server:~$ cat id_ed25519.pub >> .ssh/authorized_keys
cesar@crb-server:~$ cat .ssh/authorized_keys
ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAICjoJGfflVMnPXkenHAhr0FSTrEegmhXPCIQAQnH20Nn cesar@LenovoI7
cesar@crb-server:~$
```

Ahí está mi clave pública. 

Ahora, por seguridad, podemos acceder al fichero de configuración del servidor sshd_config (el usuario debe ser “sudoer”):

```bash
cesar@crb-server:~$ sudo nano /etc/ssh/sshd_config
```

Y cambiar lo siguiente (de yes a no):

```bash
PasswordAuthentication no
```

Ahora podemos conectarnos desde el Windows al Server-A con el usuario cesar sin contraseña gracias a haber compartido la clave pública:

```bash
PS C:\Users\cesar> ssh cesar@192.168.56.10
Welcome to Ubuntu 24.04.3 LTS (GNU/Linux 6.8.0-71-generic x86_64)

 * Documentation:  https://help.ubuntu.com
 * Management:     https://landscape.canonical.com
 * Support:        https://ubuntu.com/pro

 System information as of mié 22 oct 2025 16:31:19 UTC

  System load:             0.01
  Usage of /:              24.9% of 19.51GB
  Memory usage:            8%
  Swap usage:              0%
  Processes:               96
  Users logged in:         1
  IPv4 address for enp0s3: 10.0.2.15
  IPv6 address for enp0s3: fd00::a00:27ff:fe6f:155c


El mantenimiento de seguridad expandido para Applications está desactivado

Se pueden aplicar 0 actualizaciones de forma inmediata.

Active ESM Apps para recibir futuras actualizaciones de seguridad adicionales.
Vea https://ubuntu.com/esm o ejecute «sudo pro status»


The list of available updates is more than a week old.
To check for new updates run: sudo apt update

Last login: Wed Oct 22 16:20:49 2025 from 192.168.56.1
cesar@crb-server:~$
```

Ahora debemos hacer lo mismo desde Server-A para Server-B y Server-C.

